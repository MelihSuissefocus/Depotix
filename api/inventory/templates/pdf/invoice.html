{% load invoice_extras %}
<!DOCTYPE html>
<html lang="de-CH">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rechnung {{ invoice.invoice_number }}</title>
    <style>
        {% include "pdf/_styles.css" %}
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-row">
            <!-- Supplier info left -->
            <div class="supplier-info">
                <div>{{ supplier.name|default:"Bi-Swiss GmbH" }}</div>
                <div>{{ supplier.street|default:"Eichengasse 3" }}</div>
                <div>{{ supplier.postal_code|default:"CH-4702" }} {{ supplier.city|default:"Oensingen" }}</div>
            </div>

            <!-- Logo placeholder right -->
            <div class="logo-placeholder">
                Logo
            </div>
        </div>

        <!-- Header line -->
        <div class="header-line"></div>
    </div>

    <!-- Address and meta columns -->
    <div class="address-meta-section">
        <!-- Left column - Address -->
        <div class="left-column">
            <div class="section-title">Adresse</div>
            <div class="address-lines">
                <div>{{ customer.name }}</div>
                {% if customer.contact_name %}
                <div>{{ customer.contact_name }}</div>
                {% endif %}
                {{ customer.address|linebreaksbr }}
            </div>

            <div class="section-title delivery-address">Lieferadresse</div>
            <div class="address-lines">
                {% if customer.shipping_address %}
                    {{ customer.shipping_address|linebreaksbr }}
                {% else %}
                    <div>{{ customer.name }}</div>
                    {% if customer.contact_name %}
                    <div>{{ customer.contact_name }}</div>
                    {% endif %}
                    {{ customer.address|linebreaksbr }}
                {% endif %}
            </div>
        </div>

        <!-- Right column - Document info -->
        <div class="right-column">
            <div class="meta-line">
                <span class="meta-label">Dokument Nr.:</span>
                <span class="meta-value">{{ invoice.invoice_number }}</span>
            </div>
            <div class="meta-line">
                <span class="meta-label">Dokument Datum:</span>
                <span class="meta-value">{{ invoice.issue_date|date:"d.m.Y" }}</span>
            </div>
            <div class="meta-line">
                <span class="meta-label">Ihre Kundennr.:</span>
                <span class="meta-value">{{ customer.customer_number }}</span>
            </div>
            <div class="meta-line">
                <span class="meta-label">Lieferdatum:</span>
                <span class="meta-value">{% if order.delivery_date %}{{ order.delivery_date|date:"d.m.Y" }}{% endif %}</span>
            </div>
            <div class="meta-line">
                <span class="meta-label">Zahlungsmethode:</span>
                <span class="meta-value">Rechnung</span>
            </div>
            <div class="meta-line">
                <span class="meta-label">Zahlbar bis:</span>
                <span class="meta-value">{{ invoice.due_date|date:"d.m.Y" }}</span>
            </div>
            <div class="meta-line">
                <span class="meta-label">MwSt-Nr:</span>
                <span class="meta-value">{{ supplier.mwst_number|default:"CHE-390.391.667 MWST" }}</span>
            </div>
        </div>
    </div>

    <!-- Invoice title -->
    <div class="invoice-title-section">
        <div class="title-left">Rechnung {{ invoice.invoice_number }}</div>
        <div class="title-right">Oensingen  /  {{ invoice.issue_date|swiss_date_format }}</div>
    </div>

    <div class="title-line"></div>

    <div class="thank-you-text">
        Wir danken für ihren Auftrag und stellen Ihnen folgende Positionen in Rechnung:
    </div>

    <!-- Items table -->
    <table class="items-table">
        <thead>
            <tr>
                <th class="col-bezeichnung">Bezeichnung</th>
                <th class="col-menge">Menge</th>
                <th class="col-einheit">Einheit</th>
                <th class="col-mwst">MwSt</th>
                <th class="col-preis">Preis</th>
                <th class="col-betrag">Betrag CHF</th>
            </tr>
        </thead>
        <tbody>
            {% for line in lines %}
            <tr>
                <td class="col-bezeichnung">{{ line.name }}</td>
                <td class="col-menge">{{ line.qty_base|floatformat:0 }}</td>
                <td class="col-einheit">Verpackung</td>
                <td class="col-mwst">{{ line.tax_rate|floatformat:2 }} %</td>
                <td class="col-preis">{{ line.unit_price|swiss_currency }} CHF</td>
                <td class="col-betrag">{{ line.line_total_net|swiss_currency }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="table-bottom-line"></div>

    <!-- Info Palette section -->
    <div class="info-palette-section">
        <div class="info-title">Info Palette</div>
        {% for line in lines %}
        <div class="info-text">{{ line.qty_base }} × {{ line.name }}</div>
        {% endfor %}
    </div>

    <div class="info-bottom-line"></div>

    <!-- Totals section -->
    <div class="totals-section">
        <div class="totals-line">
            <span class="total-label">Total CHF</span>
            <span class="total-value">{{ invoice.total_net|swiss_currency }}</span>
        </div>
        <div class="totals-line">
            <span class="total-label">Total MwSt 2.60% Von CHF</span>
            <span class="total-value">{{ invoice.total_tax|swiss_currency }}</span>
        </div>
        <div class="totals-line">
            <span class="total-label">Total inkl. MwSt CHF</span>
            <span class="total-value">{{ invoice.total_gross|swiss_currency }}</span>
        </div>
    </div>

    <!-- Payment information -->
    <div class="payment-section">
        <div class="payment-title">Zahlung Bitte an:</div>
        <div class="payment-info">
            <div>{{ supplier.bank_name|default:"Basellandschaftliche Kantonalbank, Liestal" }}</div>
            <div>{{ supplier.iban|default:"CH06 0076 9442 3946 4200 2" }}</div>
        </div>

    </div>

    <!-- Greeting -->
    <div class="greeting-section">
        <div>Für ihr Vertrauen danken wir Ihnen</div>
        <div>Freundliche Grüsse</div>
        <div>{{ supplier.name|default:"Bi-Swiss GmbH" }}</div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-left">{{ supplier.name|default:"Bi-Swiss GmbH" }}  /  {{ supplier.street|default:"Eichengasse 3" }}  /  {{ supplier.postal_code|default:"4207" }} {{ supplier.city|default:"Oensingen" }}</div>
        <div class="footer-center">Telefon {{ supplier.phone|default:"+41 76 840 55 40" }}</div>
        <div class="footer-right">UID MwSt.: {{ supplier.mwst_number|default:"CHE-390.391.667 MWST" }}</div>
    </div>

    {% if qr_data_uri %}
    <!-- Page 2 - Swiss QR Bill -->
    <div class="qr-page">
        <div class="qr-header">
            <h2>QR-Rechnung</h2>
            <p>Schweizer QR-Code nach Standard ISO 20022</p>
        </div>

        <div class="qr-content">
            <div class="qr-section-left">
                <div class="qr-title">Empfangsschein</div>

                <div class="qr-field">
                    <div class="qr-label">Konto / Zahlbar an</div>
                    <div class="qr-value">{{ supplier.iban }}</div>
                    <div class="qr-value">{{ supplier.name }}</div>
                    <div class="qr-value">{{ supplier.street }}</div>
                    <div class="qr-value">{{ supplier.postal_code }} {{ supplier.city }}</div>
                </div>

                <div class="qr-field">
                    <div class="qr-label">Zahlbar durch</div>
                    <div class="qr-value">{{ customer.name }}</div>
                    {% if customer.contact_name %}
                    <div class="qr-value">{{ customer.contact_name }}</div>
                    {% endif %}
                    {{ customer.address|linebreaksbr }}
                </div>

                <div class="qr-field">
                    <div class="qr-label">Währung</div>
                    <div class="qr-value">{{ invoice.currency }}</div>
                </div>

                <div class="qr-field">
                    <div class="qr-label">Betrag</div>
                    <div class="qr-amount">{{ invoice.total_gross|swiss_currency }}</div>
                </div>
            </div>

            <div class="qr-section-center">
                <div class="qr-code-large">
                    {{ qr_data_uri|safe }}
                </div>
            </div>

            <div class="qr-section-right">
                <div class="qr-title">Zahlteil</div>

                <div class="qr-field">
                    <div class="qr-label">Währung</div>
                    <div class="qr-value">{{ invoice.currency }}</div>
                </div>

                <div class="qr-field">
                    <div class="qr-label">Betrag</div>
                    <div class="qr-amount">{{ invoice.total_gross|swiss_currency }}</div>
                </div>

                <div class="qr-field">
                    <div class="qr-label">Konto / Zahlbar an</div>
                    <div class="qr-value">{{ supplier.iban }}</div>
                    <div class="qr-value">{{ supplier.name }}</div>
                    <div class="qr-value">{{ supplier.street }}</div>
                    <div class="qr-value">{{ supplier.postal_code }} {{ supplier.city }}</div>
                </div>

                <div class="qr-field">
                    <div class="qr-label">Zusätzliche Informationen</div>
                    <div class="qr-value">Rechnung {{ invoice.invoice_number }}</div>
                    <div class="qr-value">Fälligkeitsdatum: {{ invoice.due_date|date:"d.m.Y" }}</div>
                </div>

                <div class="qr-field">
                    <div class="qr-label">Zahlbar durch</div>
                    <div class="qr-value">{{ customer.name }}</div>
                    {% if customer.contact_name %}
                    <div class="qr-value">{{ customer.contact_name }}</div>
                    {% endif %}
                    {{ customer.address|linebreaksbr }}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

</body>
</html>